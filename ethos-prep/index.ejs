/// <reference path="index.d.ts" />
const sources = <%- JSON.stringify(sources) %>;
const domains = <%- JSON.stringify(domains).replace(/"getVersions:(.*?):(.*?)"/g, "async () => (await import(/* webpackChunkName: 'ethos.$1' */ './$1.js'))['$2']") %>;
const resources = {}

function crawl(list, parent) {
    for (const entry of list) {
        if (parent)
            entry.parent = parent
        if (entry.resource) {
            resources[entry.resource] = entry
            const load = entry.getVersions
            entry.getVersions = async () => entry.versions = await load()
        } else {
            if (entry.subdomains)
                crawl(entry.subdomains, entry)
            if (entry.resources)
                crawl(entry.resources, entry)
        }
    }
}
crawl(domains)

module.exports = { sources, domains, resources }